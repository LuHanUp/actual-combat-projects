# 项目整体介绍

P2P：个人对个人的交易

金融贷款名词解释
- 标的：借款人在P2P平台上发布借款的相关信息（金额、时间、利息）
- 发标：借款人在P2P平台上发布借款的动作
- 投标：投资人针对某个`标的`进行出借的动作

# 开户


# 分布式事务

## 分布式事务基础理论-CAP理论
CAP是 Consistency、Availability、Partition tolerance三个词语的缩写，分别表示一致性、可用性、 分区容忍性
为了方便对CAP理论的理解，我们结合电商平台中的一些业务场景来理解CAP。

业务背景:
- 我们知道每台数据库服务器有他的最大连接数、负载和吞吐量，若有一天无法再满足我们的业务需求，
  就需要横向去扩展几台 Slave(从数据库) 去分担 Master(主数据库) 的压力。
- 如果服务对数据库的需求是 IO 密集型的，那可能会经常遇到增删改影响到了查询效率。这就需要 进行读写分离，
  由主数据库应付增删改操作，由从数据库应付查询操作，主从数据库的数据要进行 同步。

执行流程:
1. 商品服务请求主数据库写入商品信息(添加商品、修改商品、删除商品)
2. 主数据库向商品服务响应写入成功。
3. 商品服务请求从数据库读取商品信息。

### C - Consistency:
一致性是指写操作后的读操作可以读取到最新的数据状态，当数据分布在多个节点上，从任意节点读取 到的数据都是最新的状态。
上图中，商品信息的读写要满足一致性就是要实现如下目标: 
1. 商品服务写入主数据库成功，则向从数据库查询新数据也成功。 
2. 商品服务写入主数据库失败，则向从数据库查询新数据也失败。

### A - Availability :
可用性是指任何事务操作都可以得到响应结果，且不会出现响应超时或响应错误。 
上图中，商品信息读取满足可用性就是要实现如下目标: 
1. 从数据库接收到数据查询的请求则立即能够响应数据查询结果。 
2. 从数据库不允许出现响应超时或响应错误。 为了保证可用性，一般需要通过增加从数据库节点来实现。

### P - Partition tolerance :
通常分布式系统的各个节点部署在不同的子网，这就是网络分区，不可避免的会出现由于网络故障而导致节点之间通信失败。
分布式系统在遇到某节点或网络分区故障的时候，仍然能够对外提供满足一致性 和可用性的服务，这就是分区容忍性。
分布式系统中有某一个或者几个机器宕掉了，其他剩下的机器还 能够正常运转满足系统需求，或者是机器之间有网络异常，
将分布式系统分隔未独立的几个部分，各个 部分还能维持分布式系统的运作，这样就具有较好的分区容忍性。
上图中，商品信息读写满足分区容忍性就是要实现如下目标:
1. 主数据库向从数据库同步数据失败不影响读写操作。 
2. 其中一个节点挂掉不影响另一个节点对外提供服务。

## CAP组合方式
1. 上边的例子是否同时具备CAP呢?
在所有分布式事务场景中不会同时具备CAP三个特性，因为在具备了P的前提下C和A是不能共存的。
在保证分区容忍性的前提下，一致性和可用性无法兼顾，如果要提高系统的可用性就要增加多个节点， 如果要保证数据的一致性就要实现每个节点的数据一致，节点越多可用性越好，但是数据一致性会越 差。
2. CAP有哪些组合方式呢?
- AP: 放弃一致性，追求分区容忍性和可用性。这是很多分布式系统设计时的选择。
  例如:上边的商品管理，完全可以实现AP，前提是只要用户可以接受所查询的到数据在一定时间内不是 最新的即可。
  通常实现AP都会保证最终一致性，后面讲的BASE理论就是根据AP来扩展的，一些业务场景 
  比如:订单退款，今日退款成功，明日账户到账，只要用户可以接受在一定时间内到账即可。
- CP: 放弃可用性，追求一致性和分区容错性，我们的zookeeper其实就是追求的强一致，又比如跨行转账，.
  一次转账请求要等待双方银行系统都完成整个事务才算完成。 
- CA:放弃分区容忍性，即不进行分区，不考虑由于网络不通或节点挂掉的问题，则可以实现一致性和可用 性。
  那么系统将不是一个标准的分布式系统，我们最常用的关系型数据库就满足了CA。

## BASE理论
1. 理解强一致性和最终一致性
CAP理论告诉我们一个分布式系统最多只能同时满足一致性(Consistency)、可用性(Availability) 和分区容忍性(Partition tolerance)
这三项中的两项，其中AP在实际应用中较多，AP即舍弃一致性， 保证可用性和分区容忍性，但是在实际生产中很多场景都要实现一致性，
比如前边我们举的例子，主数 据库向从数据库同步数据，即使不要一致性，但是最终也要将数据同步成功来保证数据一致，
这种一致 性和CAP中的一致性不同，CAP中的一致性要求在任何时间查询每个节点数据都必须一致，它强调的是 强一致性，
但是最终一致性是允许可以在一段时间内每个节点的数据不一致，但是经过一段时间每个节 点的数据必须一致，它强调的是最终数据的一致性。
2. Base理论简介
BASE 是 Basically Available(基本可用)、Soft state(软状态)和 Eventually consistent (最终一致性)三个 短语的缩写。
BASE理论是对CAP中AP的一个扩展，通过牺牲强一致性来获得可用性，当出现故障允许 部分不可用但要保证核心功能可用，
允许数据在一段时间内是不一致的，但最终达到一致状态。满足 BASE理论的事务，我们称之为“柔性事务”。
- 基本可用 : 分布式系统在出现故障时，允许损失部分可用功能，保证核心功能可用。如，电商网站 交易付款出现问题了，商品依然可以正常浏览。
- 软状态 : 由于不要求强一致性，所以BASE允许系统中存在中间状态(也叫软状态)，这个状态不 影响系统可用性，
  如订单的"支付中"、“数据同步中”等状态，待数据最终一致后状态改为“成功”状 态。
- 最终一致 : 最终一致是指经过一段时间后，所有节点数据都将会达到一致。如订单的"支付中"状 态，最终会变为“支付成功”或者"支付失败"，
  使订单状态与实际交易结果达成一致，但需要一定时 间的延迟、等待。